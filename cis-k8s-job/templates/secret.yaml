{{- if (.Values.secretName | empty) }}
# if user didn't specify a secretName, use the default
apiVersion: v1
kind: Secret
metadata:
  name: cis-k8s-job-token
  namespace: {{ .Release.Namespace }}
data:
  AUTH_TOKEN: {{ .Values.authToken | b64enc }}
  JOIN_TOKEN: {{ .Values.joinToken | b64enc }}
{{- end }}
---
{{- if .Values.joinToken }}
# create a secret managed by helm if join_token is present
apiVersion: v1
kind: Secret
metadata:
  name: spire-agent-secret-{{ .Release.Name }}
  namespace: {{ .Release.Namespace }}
data: {}
{{- end}}